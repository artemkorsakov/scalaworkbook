<!DOCTYPE html><html><head><title>Scala workbook: Проверка фрагмента</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Артём Корсаков" /><meta name="description" content="Разработка на Scala." /><meta name="og:image" content="/scalaworkbook/img/poster.png" /><meta name="image" property="og:image" content="/scalaworkbook/img/poster.png" /><meta name="og:title" content="Scala workbook: Проверка фрагмента" /><meta name="title" property="og:title" content="Scala workbook: Проверка фрагмента" /><meta name="og:site_name" content="Scala workbook" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Разработка на Scala." /><link rel="icon" type="image/png" href="/scalaworkbook/img/favicon.png" /><meta name="twitter:title" content="Scala workbook: Проверка фрагмента" /><meta name="twitter:image" content="https://artemkorsakov.github.io/scalaworkbook/img/poster.png" /><meta name="twitter:description" content="Разработка на Scala." /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/scalaworkbook/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/scalaworkbook/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/scalaworkbook/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/scalaworkbook/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/scalaworkbook/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/scalaworkbook/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/scalaworkbook/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/scalaworkbook/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/scalaworkbook/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/scalaworkbook/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/scalaworkbook/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/scalaworkbook/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/scalaworkbook/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/scalaworkbook/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/scalaworkbook/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/scalaworkbook/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/scalaworkbook/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/scalaworkbook/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/scalaworkbook/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/scalaworkbook/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/scalaworkbook/highlight/styles/vs.css" /><link rel="stylesheet" href="/scalaworkbook/css/pattern-style.css" /><link rel="stylesheet" href="/scalaworkbook/css/override.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/scalaworkbook/" class="brand"><div class="brand-wrapper"><span>Scala workbook</span></div></a></li> <li><a href="/scalaworkbook/docs/index" class="">Обзор Scala</a> <ul class="sub-section"> <li><a href="/scalaworkbook/docs/start/getting-started" class="">С чего начать?</a></li></ul></li> <li><a href="/scalaworkbook/docs/hello_world" class="">Hello, world!</a></li> <li><a href="/scalaworkbook/docs/repl" class="">REPL</a></li> <li><a href="/scalaworkbook/docs/types" class="">Типы данных</a></li> <li><a href="/scalaworkbook/docs/structures" class="">Структуры управления</a></li> <li><a href="/scalaworkbook/docs/modeling" class="">Моделирование данных</a> <ul class="sub-section"> <li><a href="/scalaworkbook/docs/modeling/classes" class="">Classes</a></li> <li><a href="/scalaworkbook/docs/modeling/objects" class="">Objects</a></li> <li><a href="/scalaworkbook/docs/modeling/companion-objects" class="">Companion objects</a></li> <li><a href="/scalaworkbook/docs/modeling/traits" class="">Traits</a></li> <li><a href="/scalaworkbook/docs/modeling/abstract-class" class="">Абстрактные классы</a></li> <li><a href="/scalaworkbook/docs/modeling/enums" class="">Enums</a></li> <li><a href="/scalaworkbook/docs/modeling/case-class" class="">Case classes</a></li> <li><a href="/scalaworkbook/docs/modeling/oop" class="">Моделирование ООП</a></li> <li><a href="/scalaworkbook/docs/modeling/fp" class="">Моделирование ФП</a></li></ul></li> <li><a href="/scalaworkbook/docs/methods" class="">Методы</a> <ul class="sub-section"> <li><a href="/scalaworkbook/docs/methods/method-features" class="">Определение методов</a></li> <li><a href="/scalaworkbook/docs/methods/default-parameters" class="">Параметры по умолчанию</a></li> <li><a href="/scalaworkbook/docs/methods/named-parameters" class="">Именованные параметры</a></li> <li><a href="/scalaworkbook/docs/methods/by-name-parameter" class="">Параметры по имени</a></li> <li><a href="/scalaworkbook/docs/methods/partially-applied-functions" class="">Каррирование</a></li> <li><a href="/scalaworkbook/docs/methods/vararg-parameters" class="">Variable Arguments</a></li> <li><a href="/scalaworkbook/docs/methods/generic-parameter" class="">Generic параметры</a></li> <li><a href="/scalaworkbook/docs/methods/extension-methods" class="">Методы расширения</a></li> <li><a href="/scalaworkbook/docs/methods/main-methods" class="">main методы</a></li></ul></li> <li><a href="/scalaworkbook/docs/functions" class="">Функции</a> <ul class="sub-section"> <li><a href="/scalaworkbook/docs/functions/anonymous" class="">Анонимные функции</a></li> <li><a href="/scalaworkbook/docs/functions/variables" class="">Параметры функции</a></li> <li><a href="/scalaworkbook/docs/functions/eta" class="">Eta расширение</a></li> <li><a href="/scalaworkbook/docs/functions/hofs" class="">Функции высшего порядка</a></li> <li><a href="/scalaworkbook/docs/functions/write-map" class="">Собственный map</a></li> <li><a href="/scalaworkbook/docs/functions/returns-function" class="">Возврат функции в методе</a></li></ul></li> <li><a href="/scalaworkbook/docs/packaging" class="">Пакеты и импорт</a></li> <li><a href="/scalaworkbook/docs/toplevel-definitions" class="">Верхнеур. определения</a></li> <li><a href="/scalaworkbook/docs/collections" class="">Коллекции</a> <ul class="sub-section"> <li><a href="/scalaworkbook/docs/collections/classes" class="">Типы коллекций</a></li> <li><a href="/scalaworkbook/docs/collections/list" class="">List</a></li> <li><a href="/scalaworkbook/docs/collections/lazylist" class="">LazyList</a></li> <li><a href="/scalaworkbook/docs/collections/array-seq" class="">ArraySeq</a></li> <li><a href="/scalaworkbook/docs/collections/vector" class="">Vector</a></li> <li><a href="/scalaworkbook/docs/collections/array-buffer" class="">ArrayBuffer</a></li> <li><a href="/scalaworkbook/docs/collections/maps" class="">Maps</a></li> <li><a href="/scalaworkbook/docs/collections/set" class="">Set</a></li> <li><a href="/scalaworkbook/docs/collections/range" class="">Range</a></li> <li><a href="/scalaworkbook/docs/collections/tuple" class="">Tuple</a></li> <li><a href="/scalaworkbook/docs/collections/queue" class="">Queue</a></li> <li><a href="/scalaworkbook/docs/collections/methods" class="">Методы в коллекциях</a></li></ul></li> <li><a href="/scalaworkbook/docs/fp" class="">Функц. программирование</a> <ul class="sub-section"> <li><a href="/scalaworkbook/docs/fp/what-is-fp" class="">Что такое ФП?</a></li> <li><a href="/scalaworkbook/docs/fp/immutable-values" class="">Неизменяемые значения</a></li> <li><a href="/scalaworkbook/docs/fp/pure-functions" class="">Чистые функции</a></li> <li><a href="/scalaworkbook/docs/fp/functions-are-values" class="">Функции - это значения</a></li> <li><a href="/scalaworkbook/docs/fp/functional-error-handling" class="">Обработка ошибок</a></li></ul></li> <li><a href="/scalaworkbook/docs/type-system" class="">Система типов</a> <ul class="sub-section"> <li><a href="/scalaworkbook/docs/type-system/types-inferred" class="">Определение типов</a></li> <li><a href="/scalaworkbook/docs/type-system/types-generics" class="">Generics типы</a></li> <li><a href="/scalaworkbook/docs/type-system/types-intersection" class="">Пересечение типов</a></li> <li><a href="/scalaworkbook/docs/type-system/types-union" class="">Объединение типов</a></li> <li><a href="/scalaworkbook/docs/type-system/types-adts" class="">Алгебр. типы данных</a></li> <li><a href="/scalaworkbook/docs/type-system/types-variance" class="">Ковариантность</a></li> <li><a href="/scalaworkbook/docs/type-system/types-opaque" class="">Непрозрачные типы</a></li> <li><a href="/scalaworkbook/docs/type-system/types-structural" class="">Структурные типы</a></li> <li><a href="/scalaworkbook/docs/type-system/types-dependent-function" class="">Зависимые типы функций</a></li> <li><a href="/scalaworkbook/docs/type-system/type-lambdas" class="">Type Lambdas</a></li> <li><a href="/scalaworkbook/docs/type-system/match-types" class="">Match Types</a></li> <li><a href="/scalaworkbook/docs/type-system/polymorphic-function-types" class="">Полимор. типы функций</a></li> <li><a href="/scalaworkbook/docs/type-system/types-others" class="">Другие типы</a></li></ul></li> <li><a href="/scalaworkbook/docs/abstractions" class="">Абстракции</a> <ul class="sub-section"> <li><a href="/scalaworkbook/docs/abstractions/ca-given" class="">Given</a></li> <li><a href="/scalaworkbook/docs/abstractions/ca-using" class="">Using</a></li> <li><a href="/scalaworkbook/docs/abstractions/type-classes" class="">Класс типов</a></li> <li><a href="/scalaworkbook/docs/abstractions/ca-context-bounds" class="">Контекстные границы</a></li> <li><a href="/scalaworkbook/docs/abstractions/ca-given-imports" class="">Given imports</a></li> <li><a href="/scalaworkbook/docs/abstractions/ca-extension-methods" class="">Методы расш. - детали</a></li> <li><a href="/scalaworkbook/docs/abstractions/ca-type-classes" class="">Импл. type классов</a></li> <li><a href="/scalaworkbook/docs/abstractions/ca-type-class-derivation" class="">Type Class Derivation</a></li> <li><a href="/scalaworkbook/docs/abstractions/ca-multiversal-equality" class="">Multiversal Equality</a></li> <li><a href="/scalaworkbook/docs/abstractions/context-functions" class="">Контекстные функции</a></li> <li><a href="/scalaworkbook/docs/abstractions/ca-implicit-conversions" class="">Неявные преобр.</a></li> <li><a href="/scalaworkbook/docs/abstractions/ca-by-name-parameters" class="">Конт. пар. по имени</a></li></ul></li> <li><a href="/scalaworkbook/docs/details" class="">Детали</a> <ul class="sub-section"> <li><a href="/scalaworkbook/docs/details/export-causes" class="">Предложения export</a></li> <li><a href="/scalaworkbook/docs/details/parameter-untupling" class="">Распаковка параметров</a></li> <li><a href="/scalaworkbook/docs/details/type-test" class="">Проверка типа</a></li> <li><a href="/scalaworkbook/docs/details/pattern-matching" class="">Экстракторы</a></li></ul></li> <li><a href="/scalaworkbook/docs/concurrency" class="">Параллелизм</a></li> <li><a href="/scalaworkbook/docs/tools" class="">Утилиты</a> <ul class="sub-section"> <li><a href="/scalaworkbook/docs/tools/tools-sbt" class="">Sbt</a></li> <li><a href="/scalaworkbook/docs/tools/tools-worksheets" class="">Worksheet</a></li></ul></li> <li><a href="/scalaworkbook/docs/with_java" class="">Взаимодействие с Java</a></li> <li><a href="/scalaworkbook/docs/metaprogramming" class="">Metaprogramming</a> <ul class="sub-section"> <li><a href="/scalaworkbook/docs/metaprogramming/inline" class="">Inline</a></li> <li><a href="/scalaworkbook/docs/metaprogramming/compile-time-ops" class="">Compile-time ops</a></li> <li><a href="/scalaworkbook/docs/metaprogramming/macros" class="">Macros</a></li> <li><a href="/scalaworkbook/docs/metaprogramming/quoted-code" class="">Quoted Code</a></li> <li><a href="/scalaworkbook/docs/metaprogramming/runtime-staging" class="">Runtime Staging</a></li> <li><a href="/scalaworkbook/docs/metaprogramming/reflection" class="">Reflection</a></li> <li><a href="/scalaworkbook/docs/metaprogramming/tasty-inspection" class="">TASTy Inspection</a></li></ul></li> <li><a href="/scalaworkbook/docs/soft-keywords" class="">Soft Keywords</a></li> <li><a href="/scalaworkbook/docs/scaladoc" class="">Scaladoc</a> <ul class="sub-section"> <li><a href="/scalaworkbook/docs/scaladoc/docstrings" class="">Документы</a></li> <li><a href="/scalaworkbook/docs/scaladoc/linking" class="">Ссылки</a></li> <li><a href="/scalaworkbook/docs/scaladoc/static-site" class="">Статика</a></li> <li><a href="/scalaworkbook/docs/scaladoc/blog" class="">Блог</a></li> <li><a href="/scalaworkbook/docs/scaladoc/site-versioning" class="">Версионность</a></li> <li><a href="/scalaworkbook/docs/scaladoc/search-engine" class="">Поиск по типу</a></li> <li><a href="/scalaworkbook/docs/scaladoc/snippet-compiler" class=" active ">Проверка фрагмента</a></li> <li><a href="/scalaworkbook/docs/scaladoc/settings" class="">Настройки</a></li></ul></li>        </ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="search-nav hidden-xs hidden-sm"><div id="search-dropdown"><label><i class="fa fa-search"></i>Search</label><input id="search-bar" type="text" placeholder="Enter keywords here..." onclick="displayToggleSearch(event)" /><ul id="search-dropdown-content" class="dropdown dropdown-content"></ul></div></li></ul></div></div></div></div><div id="content" data-github-owner="artemkorsakov" data-github-repo="scalaworkbook"><div class="content-wrapper"><section><h2 id="проверка-фрагмента">Проверка фрагмента</h2>

<p>Основная функциональность документации — помочь пользователям понять и правильно использовать проект. 
Иногда часть проекта нуждается в нескольких словах, чтобы показать ее использование, 
но бывают моменты, когда описания недостаточно, и нет ничего лучше, чем подробный пример.</p>

<p>Удобный способ предоставления примеров в документации — 
создание фрагментов кода, представляющих использование заданной функциональности. 
Проблема фрагментов кода в том, что одновременно с разработкой проекта их нужно обновлять. 
Иногда изменения в одной части проекта могут нарушить работу примеров в других частях. 
Количество фрагментов и количество времени, прошедшего с момента их написания, 
не позволяет запомнить каждое место, где нужно их исправить. 
Через какое-то время наступает понимание, что документация — полный бардак 
и нужно пройтись по всем примерам и переписать их.</p>

<p>Многие проекты Scala 2 используют markdown документацию с проверкой типов с помощью 
<a href="https://tpolecat.github.io/tut/">tut</a> или <a href="https://scalameta.org/mdoc/">mdoc</a>. 
Почти все хотя бы слышали об этих инструментах. 
Поскольку они оказались очень полезными и сообщество Scala их успешно приняло, 
планируется включить функции <code class="highlighter-rouge">tut</code> и <code class="highlighter-rouge">mdoc</code> в компилятор, чтобы он был готов к включению в Scaladoc.</p>

<p><img src="https://docs.scala-lang.org/resources/images/scala3/scaladoc/snippet-compiler3.png" alt="" /></p>

<h3 id="начало-работы">Начало работы</h3>

<p>По умолчанию проверка фрагментов отключена. 
Её можно включить, добавив в Scaladoc следующий аргумент <code class="highlighter-rouge">-snippet-compiler:compile</code></p>

<p>Например, в sbt конфигурация выглядит так:</p>

<pre><code class="language-sbt">Compile / doc / scalacOptions ++= Seq("-snippet-compiler:compile")
</code></pre>

<p>Эта опция включает компилятор сниппетов для всех <code class="highlighter-rouge">scala</code> сниппетов в проектной документации 
и распознает все сниппеты внутри ``` блоков scala. 
В настоящее время проверка фрагментов работает как в строках документации, 
написанных в Markdown, так и на статических сайтах.</p>

<p><img src="https://docs.scala-lang.org/resources/images/scala3/scaladoc/snippet-compiler4.png" alt="" /></p>

<p>Для нового проекта этой конфигурации должно хватить. 
Однако, если вы переносите существующий проект, можно отключить компиляцию для некоторых фрагментов, 
которые в настоящее время не могут быть обновлены.</p>

<p>Для этого добавьте <code class="highlighter-rouge">nocompile</code> флаг прямо в scala сниппет:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```scala sc:nocompile
// under the hood `map` is transformed into
List(1).map( _  + 1)(&lt;implicits&gt;)
```
</code></pre></div></div>

<p>Однако иногда сбой компиляции является преднамеренным поведением, например, для демонстрации ошибки. 
В этом случае выставляется флаг <code class="highlighter-rouge">fail</code>, который представляет одну из функций: <em>Assert compilation errors</em>.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```scala sc:fail
List(1,2,3).toMap
```
</code></pre></div></div>

<h3 id="обзор-функций">Обзор функций</h3>

<h4 id="assert-compilation-errors">Assert compilation errors</h4>

<p>Scala — это язык программирования со статической типизацией. 
Иногда в документации должны упоминаться случаи, когда код не должен компилироваться, 
или авторы хотят предоставить способы восстановления после определенных ошибок компиляции.</p>

<p>Например, этот код:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">).</span><span class="py">toMap</span>
</code></pre></div></div>

<p>приводит к результату:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>At 18:21:
  List(1,2,3).toMap
Error: Cannot prove that Int &lt;:&lt; (K, V)

where:    K is a type variable with constraint 
          V is a type variable with constraint 
.
</code></pre></div></div>

<p>Примеры, представляющие код, который дает сбой во время компиляции, могут быть очень важными. 
Например, можно показать, как библиотека защищена от неправильного кода. 
Другой вариант использования — представить распространенные ошибки и способы их решения. 
Принимая во внимание эти варианты использования, 
предоставляется функция проверки того, компилируются ли отмеченные фрагменты кода.</p>

<p>Для фрагментов кода, которые намеренно не компилируются, например следующего, добавьте флаг <code class="highlighter-rouge">fail</code> во фрагмент кода:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```scala sc:fail
List(1,2,3).toMap
```
</code></pre></div></div>

<p>Проверка фрагмента проходит успешно и показывает ожидаемые ошибки компиляции в документации.</p>

<p><img src="https://docs.scala-lang.org/resources/images/scala3/scaladoc/assert-compilation-errors.gif" alt="" /></p>

<p>Для фрагмента, который компилируется без ошибок:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```scala sc:fail
List((1,2), (2,3)).toMap
```
</code></pre></div></div>

<p>результирующий вывод выглядит следующим образом:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>In static site (./docs/docs/index.md):
Error: Snippet should not compile but compiled succesfully
</code></pre></div></div>

<h4 id="контекст">Контекст</h4>

<p>В Scaladoc внедрён механизм переноса, предоставляющий контекст для каждого фрагмента. 
Эта предварительная обработка выполняется автоматически для всех фрагментов в строках документации.</p>

<p>Например, предположим, что необходимо задокументировать метод <code class="highlighter-rouge">slice</code> в файле <code class="highlighter-rouge">collection.List</code> 
для того, чтобы объяснить, как он работает, 
сравнив его с комбинацией методов <code class="highlighter-rouge">drop</code> и <code class="highlighter-rouge">take</code>, используя такой фрагмент кода:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">slice</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span> <span class="o">==</span> <span class="nf">drop</span><span class="o">(</span><span class="mi">2</span><span class="o">).</span><span class="py">take</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
</code></pre></div></div>

<p>Показ этого примера — одна из первых вещей, которые приходят на ум, 
но он не скомпилируется без функции контекста.</p>

<p>Помимо основной цели, это уменьшает шаблон фрагмента, 
потому что не нужно импортировать элементы одного и того же пакета 
и создавать экземпляры документированного класса.</p>

<p>Фрагмент кода после предварительной обработки выглядит так:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="nn">scala.collection</span>
<span class="k">trait</span> <span class="nc">Snippet</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span> <span class="n">self</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span>
  <span class="nf">slice</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">5</span><span class="o">)</span> <span class="o">==</span> <span class="nf">drop</span><span class="o">(</span><span class="mi">2</span><span class="o">).</span><span class="py">take</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="скрытие-кода">Скрытие кода</h4>

<p>Несмотря на наличие контекстной функции, описанной выше, 
иногда автору необходимо предоставить больше элементов для области действия. 
Однако, с одной стороны, большой блок импортов 
и инициализаций необходимых классов может привести к потере читабельности. 
Но с другой стороны, хотелось бы иметь возможность видеть весь код. 
Для второго случая введен специальный синтаксис для сниппетов, 
который скрывает определенные фрагменты <code class="highlighter-rouge">import</code> кода — операторы, например, — 
но также позволяет расширить этот код в документации одним щелчком мыши.</p>

<p>Пример:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//{</span>
<span class="k">import</span> <span class="nn">scala.collection.immutable.List</span>
<span class="c1">//}</span>
<span class="k">val</span> <span class="nv">intList</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span>
</code></pre></div></div>

<p><img src="https://docs.scala-lang.org/resources/images/scala3/scaladoc/hiding-code.gif" alt="" /></p>

<h4 id="snippet-includes">Snippet includes</h4>

<p>При написании фрагментов кода часто требуется механизм повторного использования кода из одного фрагмента в другом. 
Например, взгляните на следующий фрагмент документации:</p>

<p><img src="https://docs.scala-lang.org/resources/images/scala3/scaladoc/documentation-snippet.png" alt="" /></p>

<p>Чтобы успешно скомпилировать последний фрагмент, нужно иметь ранее объявленные определения в области видимости. 
Для этого сценария — и, возможно, для многих других — добавлена новая функция: включение сниппета. 
Она позволяет повторно использовать код из одного фрагмента в другом, 
что снижает избыточность и повышает удобство сопровождения.</p>

<p>Чтобы настроить это, добавьте аргумент <code class="highlighter-rouge">sc-name</code> к фрагменту, 
который необходимо включить в более поздний блок кода: <code class="highlighter-rouge">```scala sc-name:&lt;snippet-name&gt;</code></p>

<p>где <code class="highlighter-rouge">snippet-name</code> должен быть уникальным в пределах файла и не может содержать пробелы и запятые.</p>

<p>Затем в более позднем блоке кода в документации используйте аргумент <code class="highlighter-rouge">sc-compile-with</code> во <code class="highlighter-rouge">scala</code> фрагменте, 
который должен “включать” предыдущий блок кода: <code class="highlighter-rouge">```scala sc-compile-with:&lt;snippet-name&gt;(,&lt;snippet-name&gt;)+</code></p>

<p>где <code class="highlighter-rouge">snippet-name</code> - имя фрагмента, который должен быть включен.</p>

<p>После настройки этой функции в примере код выглядит так:</p>

<p><img src="https://docs.scala-lang.org/resources/images/scala3/scaladoc/documentation-snippet2.png" alt="" /></p>

<p>и вывод выглядит так:</p>

<p><img src="https://docs.scala-lang.org/resources/images/scala3/scaladoc/snippet-includes.png" alt="" /></p>

<p>Можно указать более одного включения. 
Обратите внимание, что порядок, в котором они указаны, определяет порядок включения.</p>

<blockquote>
  <p>можно включать только фрагменты, определенные над целевым фрагментом.</p>
</blockquote>

<h3 id="расширенная-конфигурация">Расширенная конфигурация</h3>

<p>Часто включение проверки фрагментов для всех фрагментов не является желаемым уровнем контроля, 
поскольку варианты использования могут быть более сложными. 
Для таких ситуаций подготовлен инструмент, чтобы пользователи могли настроить его под свои нужды.</p>

<h4 id="доступные-флаги">Доступные флаги</h4>

<p>Чтобы обеспечить больший контроль, компилятор фрагмента предоставляет три флага, 
которые позволяют изменить его поведение:</p>
<ul>
  <li><code class="highlighter-rouge">compile</code> - включает проверку сниппетов</li>
  <li><code class="highlighter-rouge">nocompile</code> - отключает проверку сниппетов</li>
  <li><code class="highlighter-rouge">fail</code> - включает проверку сниппета с подтверждением ошибки компиляции</li>
</ul>

<h4 id="настройки-на-основе-пути">Настройки на основе пути</h4>

<p>Для большей гибкости вместо установки одного флага для управления всеми сниппетами в проекте 
его можно установить только для определенного пути, добавив префикс <code class="highlighter-rouge">&lt;path&gt;=</code> перед флагом. 
Например:</p>

<p><code class="highlighter-rouge">-snippet-compiler:docs=compile</code> - устанавливает флаг <code class="highlighter-rouge">compile</code> для сниппетов в <code class="highlighter-rouge">docs</code>.</p>

<p>Если <code class="highlighter-rouge">docs</code> - это каталог, флаг устанавливается для всех файлов внутри <code class="highlighter-rouge">docs</code>.</p>

<p>Кроме того, <code class="highlighter-rouge">-snippet-compiler</code> может управляться более чем одним параметром, 
при этом параметры разделяются запятыми. Например:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-snippet-compiler:docs=compile,library/src=compile,library/src/scala/quoted=nocompile,library/src/scala/compiletime=fail
</code></pre></div></div>

<p>Флаги выбираются по самому длинному совпадению префикса, поэтому можно определить общую настройку, 
а затем изменить это поведение по умолчанию для более конкретных путей.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-snippet-compiler:compile,library/src/scala/quoted=nocompile,library/src/scala/compiletime=fail 
</code></pre></div></div>

<p>Флаг без префикса пути, такой как флаг <code class="highlighter-rouge">compile</code> в этом примере, считается значением по умолчанию.</p>

<h4 id="переопределение-прямо-во-фрагменте">Переопределение прямо во фрагменте</h4>

<p>Аргументы CLI — хороший механизм для установки флагов для определенных файлов. 
Однако этот подход нельзя использовать для настройки определенных фрагментов. 
Допустим, необходимо написать один фрагмент кода, который должен потерпеть неудачу, 
и другие фрагменты, которые должны скомпилироваться. 
Эти аргументы находятся в информационной части сниппета:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```scala &lt;snippet-compiler-args&gt;
// snippet
```
</code></pre></div></div>

<p>Например, чтобы настроить проверку для определенного фрагмента, 
добавьте следующий аргумент в его информационную часть фрагмента, 
где <code class="highlighter-rouge">flag</code> - один из доступных флагов, перечисленных выше (например, <code class="highlighter-rouge">compile</code>, <code class="highlighter-rouge">nocompile</code> или <code class="highlighter-rouge">fail</code>):</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sc:&lt;flag&gt;
</code></pre></div></div>

<p>В качестве конкретного примера этот код показывает, как использовать флаг <code class="highlighter-rouge">fail</code> в отдельном фрагменте:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```scala sc:fail
val itShouldFail: Int = List(1.1, 2, 3).head
```
</code></pre></div></div>

<hr />

<p><strong>References:</strong></p>
<ul>
  <li><a href="https://docs.scala-lang.org/scala3/guides/scaladoc/snippet-compiler.html">Scaladoc Guide</a></li>
</ul>


<hr>
<div class="edit-button" style="display: flex; justify-content: space-between;">
    
    <a href="/scalaworkbook/docs/scaladoc/search-engine" class="btn-sm btn-info btn-left"><-- Предыдущая</a>
    
    
    <a href="/scalaworkbook/docs/scaladoc/settings" class="btn-sm btn-info btn-right">Следующая --></a>
    
</div>
</section><div class="edit-button"><a href="https://github.com/artemkorsakov/scalaworkbook/edit/main/docs/docs/docs/scaladoc/snippet-compiler.md" target="_blank" rel="noopener noreferrer" class="btn-sm btn-info">Редактировать страницу</a></div></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/scalaworkbook/highlight/highlight.pack.js"></script><script src="/scalaworkbook/lunr/lunr.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script src="/scalaworkbook/js/search.js"></script><script src="/scalaworkbook/js/main.js"></script></body></html>