---
layout: dp
title: "Proxy"
section: dp
prev: structural/flyweight
next: behavioral
---

## {{page.title}}

#### Назначение

Предоставление суррогата или заполнителя для другого объекта, чтобы управлять доступом к нему.

"Заместитель" хранит ссылку, которая позволяет заместителю обратиться к реальному субъекту 
(объект класса "Заместитель" может обращаться к объекту класса "Субъект", 
если интерфейсы "Реального Субъекта" и "Субъекта" одинаковы). 
Поскольку интерфейс "Реального Субъекта" идентичен интерфейсу "Субъекта", 
так, что "Заместителя" можно подставить вместо "Реального Субъекта", 
он контролирует доступ к "Реальному Субъекту", 
а также может отвечать за создание или удаление "Реального Субъекта". 
"Субъект" определяет общий для "Реального Субъекта" и "Заместителя" интерфейс так, 
что "Заместитель" может быть использован везде, где ожидается "Реальный Субъект". 
При необходимости запросы могут быть переадресованы "Заместителем" "Реальному Субъекту".

#### Виды

- **Протоколирующий прокси**: сохраняет в лог все вызовы "Субъекта" с их параметрами.
- **Удалённый заместитель** (_remote proxies_): обеспечивает связь с "Субъектом", 
который находится в другом адресном пространстве или на удалённой машине. 
Также может отвечать за кодирование запроса и его аргументов и отправку закодированного запроса реальному "Субъекту".
- **Виртуальный заместитель** (_virtual proxies_): обеспечивает создание реального "Субъекта" только тогда, 
когда он действительно понадобится. Также может кэшировать часть информации о реальном "Субъекте", чтобы отложить его создание.
- **Копировать-при-записи**: обеспечивает копирование "субъекта" 
при выполнении клиентом определённых действий (частный случай "виртуального прокси").
- **Защищающий заместитель** (_protection proxies_): может проверять, 
имеет ли вызывающий объект необходимые для выполнения запроса права.
- **Кэширующий прокси**: обеспечивает временное хранение результатов расчёта до отдачи их множественным клиентам, 
которые могут разделить эти результаты.
- **Экранирующий прокси**: защищает "Субъект" от опасных клиентов (или наоборот).
- **Синхронизирующий прокси**: производит синхронизированный контроль доступа к "Субъекту" в асинхронной многопоточной среде.
- **"Умная" ссылка** (_smart reference proxy_): производит дополнительные действия, 
когда на "Субъект" создается ссылка, например, рассчитывает количество активных ссылок на "Субъект".

#### Диаграмма

![Proxy](https://upload.wikimedia.org/wikipedia/ru/0/08/Proxy_patt.gif)

```scala mdoc:silent
// "Subject"
trait IMath:
  def add(x: Double, y: Double): Double

// "Real Subject"
object Math extends IMath:
  def add(x: Double, y: Double) = x + y

// "Proxy Object"
class MathProxy extends IMath:
  private lazy val math = Math

  def add(x: Double, y: Double) = math.add(x, y)
```

```scala mdoc
val p: IMath = new MathProxy
p.add(4, 2)
```

#### Примеры

##### Протоколирующий прокси

##### Удалённый заместитель

##### Виртуальный заместитель

Отложенное вычисление Scala обеспечивает прямую языковую поддержку некоторых аспектов шаблона Proxy.

```scala mdoc
class VirtualProxy:
  lazy val expensiveOperation = List (1 to 1000000000)
```

##### Копировать-при-записи

##### Защищающий заместитель

##### Кэширующий прокси

##### Экранирующий прокси

##### Синхронизирующий прокси

##### "Умная" ссылка


---

**References:**
- [Scala & Design Patterns by Frederik Skeel Løkke](https://www.scala-lang.org/old/sites/default/files/FrederikThesis.pdf)
- [Wikipedia](https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%BC%D0%B5%D1%81%D1%82%D0%B8%D1%82%D0%B5%D0%BB%D1%8C_(%D1%88%D0%B0%D0%B1%D0%BB%D0%BE%D0%BD_%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F))
