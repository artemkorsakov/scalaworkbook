---
layout: docsplus
title: "Имплементация type классов"
prev: ../type-system/types-others
next: ../abstractions/ca-given-using
---

## {{page.title}}

Класс типов — это абстрактный параметризованный тип, 
который позволяет добавлять новое поведение к любому закрытому типу данных без использования подтипов. 
Это полезно во многих случаях, например:
- выражение того, как тип, которым вы не владеете, например, из стандартной или сторонней библиотеки,
  соответствует такому поведению
- добавление поведения к нескольким типам без введения отношений подтипов между этими типами

В Scala 3 классы типов — это просто trait-ы с одним или несколькими параметрами типа, 
реализации которых предоставляются заданными экземплярами.

### Пример

Рассмотрим `Show` - хорошо известный класс типов в Haskell. 
Следующий код показывает один из способов его реализации в Scala 3. 
Предположим, что классы Scala не имеют метода `toString`. 
Можно определить класс `Show`, чтобы добавить это поведение к любому классу, 
который необходимо преобразовать в пользовательскую строку.

#### Класс типа

Первым шагом в создании класса типа является объявление параметризованного trait, 
который имеет один или несколько абстрактных методов. 
Поскольку у `Showable` есть только один метод с именем `show`, он написан так:

```scala mdoc:silent
// Класс типа
trait Showable[A]:
  extension(a: A) def show: String
```

В Scala 3 это способ сказать, что любой тип, который реализует этот trait, должен определять, как работает метод `show`. 
Обратите внимание, что синтаксис очень близок к обычному trait:

```scala
// a trait
trait Show:
  def show: String
```

Следует отметить несколько важных моментов:
- классы типов, такие как `Showable`, принимают параметр типа `A`, чтобы установить, 
для какого типа предоставляется реализация `show`; Напротив, стандартные trait, такие, как `Show`, этого не делают.
- чтобы добавить функциональность `show` к определенному типу `A`, 
стандартный trait требует, чтобы `A` расширял `Show`, 
в то время как для классов типов требуется реализация `Showable[A]`.
- чтобы разрешить одинаковый синтаксис вызова метода в обоих `Showable`, который имитирует один из `Show`, 
`Showable.show` определяется как метод расширения.

#### Реализация конкретных экземпляров

Следующий шаг — определить, для каких классов должен работать `Showable`, а затем реализовать это поведение. 
Например, чтобы реализовать `Showable` для данного класса `Person`:

```scala mdoc:silent
case class Person(firstName: String, lastName: String)
```

нужно определить `given` значение для `Showable[Person]`. 
Этот код предоставляет конкретный экземпляр `Showable` для класса `Person`:

```scala mdoc:silent
given Showable[Person] with
  extension(p: Person) def show: String =
    s"${p.firstName} ${p.lastName}"
```

Как показано, `Showable[Person]` определяет метод расширения класса `Person` 
и использует ссылку `p` внутри тела метода `show`.

#### Использование класса типов

Этот класс типа можно использовать следующим образом:

```scala mdoc
val person = Person("John", "Doe")
println(person.show)
```

Опять же, если бы в Scala не было метода `toString`, доступного для каждого класса, 
можно было бы использовать эту технику, чтобы добавить поведение `Showable` к любому классу, 
который необходимо преобразовать в `String`.

#### Написание методов, использующих класс типов

Как и в случае с наследованием, можно определить методы, использующие `Showable` в качестве параметра типа:

```scala mdoc
def showAll[S: Showable](xs: List[S]): Unit =
  xs.foreach(x => println(x.show))
showAll(List(Person("Jane", "Jackson"), Person("Mary", "Jameson")))
```

#### Класс типов с несколькими методами

Если необходимо создать класс типов с несколькими методами, исходный синтаксис выглядит следующим образом:

```scala
trait HasLegs[A]:
  extension (a: A)
    def walk(): Unit
    def run(): Unit
```

#### Реальный пример

Реальный пример того, как классы типов используются в Scala 3, см. в обсуждении `CanEqual` 
в разделе [Multiversal Equality](./ca-multiversal-equality).


---

**References:**
- [Scala3 book](https://docs.scala-lang.org/scala3/book/ca-type-classes.html)
