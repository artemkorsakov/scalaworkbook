---
layout: docs
title: "Given и Using"
---

## {{page.title}}

Scala 3 предлагает две важные функции для контекстной абстракции:
- **Using предложения** позволяют указать параметры, 
которые на месте вызова могут быть опущены программистом и должны автоматически предоставляться контекстом
- **Экземпляры given** позволяют определять термины, 
которые компилятор Scala может использовать для заполнения отсутствующих аргументов

### Using предложения

При проектировании системы часто необходимо предоставлять различным компонентам контекстную информацию, 
такую как конфигурация или настройки. 
Одним из распространенных способов добиться этого является 
передача конфигурации в качестве дополнительного аргумента метода.

В следующем примере определяется case класс `Config` 
для моделирования некоторой конфигурации веб-сайта и передачи ее в различные методы:

```scala
case class Config(port: Int, baseUrl: String)

def renderWebsite(path: String, c: Config): String =
    "<html>" + renderWidget(List("cart"), c)  + "</html>"

def renderWidget(items: List[String], c: Config): String = ???

val config = Config(8080, "docs.scala-lang.org")
renderWebsite("/home", config)
```

Предположим, что конфигурация не меняется на протяжении большей части кодовой базы. 
Передача `c` для каждого вызова метода (например, `renderWidget`) становится очень утомительной 
и затрудняет чтение программы, поскольку нужно игнорировать аргумент `c`.

##### Использование using для обозначения параметров как контекстных

В Scala 3 некоторые параметры можно отмечать как контекстные.

```scala
def renderWebsite(path: String)(using c: Config): String =
    "<html>" + renderWidget(List("cart"))    + "</html>"
    //                                   ^^^
    //                   аргумент 'c' теперь можно не указывать

def renderWidget(items: List[String])(using c: Config): String = ???
```

Начав секцию параметров с ключевого слова `using`, мы сообщаем компилятору Scala, 
что на месте вызова он должен автоматически найти аргумент с правильным типом. 
Таким образом, компилятор Scala выполняет вывод терминов (**term inference**).

В вызове `renderWidget(List("cart"))` компилятор Scala увидит, что в области действия (`c`) есть терм типа `Config`, 
и автоматически предоставит его в `renderWidget`. 
Таким образом, программа эквивалентна приведенной выше.

На самом деле, поскольку больше не нужно ссылаться на `c` в последней реализации `renderWebsite`, 
можно даже не указывать его имя в подписи:

```scala
//                     не нужно придумывать имя параметра
//                              vvvvvvvvvvvv
def renderWebsite(path: String)(using Config): String =
  "<html>" + renderWidget(List("cart")) + "</html>"
```

##### Явное предоставление контекстных аргументов

Было показано, как абстрагироваться от контекстных параметров и 
что компилятор Scala может автоматически предоставлять аргументы. 

Но подобно тому, как задается раздел параметров с `using`, 
контекстные аргументы можно указать явно с помощью того же `using`:

```scala
renderWebsite("/home")(using config)
```

Явное предоставление контекстных параметров может быть полезно, 
если в области видимости доступны несколько разных подходящих по типу значений, 
и мы хотим убедиться, что в функцию передается правильное значение.

Для всех остальных случаев, как будет видно в следующем разделе, 
есть еще один способ ввести контекстуальные значения в область видимости.


### Экземпляры given

Было показано, что можно явно передавать аргументы в качестве контекстных параметров, 
пометив раздел аргументов вызова с помощью `using`. 
Однако, если есть единственное каноническое значение для определенного типа, 
существует другой предпочтительный способ сделать его доступным для компилятора Scala: пометив его как `given`.

```scala
val config = Config(8080, "docs.scala-lang.org")
//  это тип, который мы хотим предоставить
//  в качестве канонического значения для
//    vvvvvv
given Config = config
//             ^^^^^^
// это значение, которое выведет компилятор Scala
// в качестве аргумента для контекстного параметра типа Config
```

В приведенном выше примере указано, что всякий раз, 
когда контекстный параметр типа `Config` опускается в текущей области видимости, 
компилятор должен выводить `config` в качестве аргумента.

Определив `given` для `Config`, можно просто вызвать `renderWebsite`:

```scala
renderWebsite("/home")
//                    ^^^^^
//               аргумент не нужен
```


---

**References:**
- [Scala3 book](https://docs.scala-lang.org/scala3/book/ca-given-using-clauses.html)
