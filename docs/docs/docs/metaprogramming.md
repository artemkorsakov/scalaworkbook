---
layout: docsplus
title: "Metaprogramming"
prev: with_java
next: metaprogramming/inline
---

## {{page.title}}

На следующих страницах представлен дизайн метапрограммирования в Scala. 
Они вводят следующие основные средства:
- [inline](@DOC@metaprogramming/inline) — это новый модификатор, который гарантирует, 
что определение будет встроено в момент использования. 
Основной мотив использования `inline` — уменьшить накладные расходы, связанные с вызовами функций и доступом к значениям. 
Расширение будет выполнено компилятором Scala на этапе компиляции `Typer`. 
В отличие от встраивания в некоторых других экосистемах, встраивание в Scala — 
это не просто запрос к компилятору, а команда. 
Причина в том, что встраивание в Scala может управлять другими операциями времени компиляции, 
такими как встроенное сопоставление с образцом (включение программирования на уровне типов), 
макросы (включение времени компиляции, генеративное, метапрограммирование) 
и генерация кода во время выполнения (многоэтапное программирование). 
- [Операции времени компиляции](@DOC@metaprogramming/compile-time-ops) — 
это вспомогательные определения в стандартной библиотеке, 
которые обеспечивают поддержку операций времени компиляции над значениями и типами. 
- [Макросы](@DOC@metaprogramming/macros) построены на двух хорошо известных фундаментальных операциях: кавычках и склейках. Цитата преобразует программный код в данные, а именно в (древовидное) представление этого кода. Это выражается как '{...}для выражений, так и '[...]для типов. Сращивание, выраженное как ${ ... }, идет другим путем: оно преобразует представление программы в программный код. Вместе с inline, эти две абстракции позволяют программно конструировать программный код.

Постановка во время выполнения В то время как макросы создают код во время компиляции , постановка позволяет программам создавать новый код во время выполнения . Таким образом, генерация кода может зависеть не только от статических данных, но и от данных, доступных во время выполнения. Это разделяет оценку программы на две или более фаз или... стадий. Следовательно, этот метод генеративного программирования называется «Многоэтапное программирование». Постановка построена на тех же принципах, что и макросы. Он использует кавычки и склейки, но не включает inline.

Цитаты отражения — это представление кода в виде «черного ящика». Они могут быть параметризованы и составлены с помощью сплайсов, но их структура не может быть проанализирована извне. Отражение TASTy позволяет анализировать структуру кода, частично раскрывая тип представления фрагмента кода в стандартном API. Тип представления — это форма типизированного абстрактного синтаксического дерева, которое порождает TASTyмоникер.

TASTy Inspection Типизированные абстрактные синтаксические деревья сериализуются в специальном сжатом двоичном формате, хранящемся в .tastyфайлах. Проверка TASTy позволяет загружать эти файлы и анализировать древовидную структуру их содержимого.


---

**References:**
- [Scala 3 Reference](https://docs.scala-lang.org/scala3/reference/metaprogramming/index.html)
